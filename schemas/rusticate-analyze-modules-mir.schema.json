{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/rusticate/schemas/rusticate-analyze-modules-mir.schema.json",
  "title": "Rust Standard Library Usage Analysis",
  "description": "Analysis of stdlib usage patterns from MIR files, generated by rusticate-analyze-modules-mir",
  "type": "object",
  "required": ["generated", "mir_path", "analysis", "summary"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "generated": {
      "type": "string",
      "description": "Timestamp when analysis was generated",
      "examples": ["2025-12-16 10:30:00 -08:00"]
    },
    "mir_path": {
      "type": "string",
      "description": "Path to directory containing MIR files that were analyzed"
    },
    "analysis": {
      "$ref": "#/$defs/Analysis"
    },
    "summary": {
      "$ref": "#/$defs/Summary"
    }
  },
  "$defs": {
    "Analysis": {
      "type": "object",
      "description": "Detailed analysis results",
      "required": ["projects", "modules", "types", "traits", "methods", "greedy_cover"],
      "properties": {
        "projects": {
          "$ref": "#/$defs/ProjectStats"
        },
        "modules": {
          "$ref": "#/$defs/ItemUsage"
        },
        "types": {
          "$ref": "#/$defs/ItemUsage"
        },
        "traits": {
          "$ref": "#/$defs/ItemUsage"
        },
        "methods": {
          "$ref": "#/$defs/ItemUsage"
        },
        "methods_by_type": {
          "type": "object",
          "description": "Methods grouped by their parent type",
          "additionalProperties": {
            "$ref": "#/$defs/ItemUsage"
          }
        },
        "greedy_cover": {
          "$ref": "#/$defs/GreedyCover"
        }
      }
    },
    "ProjectStats": {
      "type": "object",
      "description": "Statistics about analyzed projects",
      "required": ["total_projects", "projects_with_mir", "total_crates", "crates_with_stdlib"],
      "properties": {
        "total_projects": {
          "type": "integer",
          "description": "Total number of Rust projects found"
        },
        "projects_with_mir": {
          "type": "integer",
          "description": "Projects that have MIR files"
        },
        "total_crates": {
          "type": "integer",
          "description": "Total unique crates analyzed"
        },
        "crates_with_stdlib": {
          "type": "integer",
          "description": "Crates that use at least one stdlib item"
        },
        "crates_without_stdlib": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of crate names that don't use stdlib"
        }
      }
    },
    "ItemUsage": {
      "type": "object",
      "description": "Usage statistics for a category of items",
      "required": ["count", "items"],
      "properties": {
        "count": {
          "type": "integer",
          "description": "Total unique items in this category"
        },
        "items": {
          "type": "array",
          "items": { "$ref": "#/$defs/UsageItem" },
          "description": "Items sorted by crate usage count (descending)"
        }
      }
    },
    "UsageItem": {
      "type": "object",
      "description": "A single stdlib item with usage statistics",
      "required": ["name", "crate_count"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Fully qualified name (e.g., std::vec::Vec::push)"
        },
        "crate_count": {
          "type": "integer",
          "description": "Number of crates that use this item"
        },
        "crates": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Optional: list of crate names that use this item"
        }
      }
    },
    "GreedyCover": {
      "type": "object",
      "description": "Greedy set cover analysis for prioritization",
      "required": ["modules", "types", "traits", "methods"],
      "properties": {
        "modules": {
          "$ref": "#/$defs/GreedyCoverCategory"
        },
        "types": {
          "$ref": "#/$defs/GreedyCoverCategory"
        },
        "traits": {
          "$ref": "#/$defs/GreedyCoverCategory"
        },
        "methods": {
          "$ref": "#/$defs/GreedyCoverCategory"
        },
        "methods_per_type": {
          "type": "object",
          "description": "Greedy cover for methods within each type",
          "additionalProperties": {
            "$ref": "#/$defs/GreedyCoverCategory"
          }
        }
      }
    },
    "GreedyCoverCategory": {
      "type": "object",
      "description": "Greedy cover results for a category",
      "required": ["touch", "full_support"],
      "properties": {
        "touch": {
          "$ref": "#/$defs/GreedyCoverResults",
          "description": "Touch coverage: crate is covered if ANY of its items are verified"
        },
        "full_support": {
          "$ref": "#/$defs/GreedyCoverResults",
          "description": "Full support: crate is covered only if ALL its items are verified"
        }
      }
    },
    "GreedyCoverResults": {
      "type": "object",
      "description": "Greedy cover results at various target percentages",
      "required": ["total_crates", "milestones"],
      "properties": {
        "total_crates": {
          "type": "integer",
          "description": "Total crates being covered"
        },
        "milestones": {
          "type": "object",
          "description": "Coverage milestones (keys are percentages like '70', '80', '90', '100')",
          "additionalProperties": {
            "$ref": "#/$defs/CoverageMilestone"
          }
        }
      }
    },
    "CoverageMilestone": {
      "type": "object",
      "description": "Items needed to reach a coverage milestone",
      "required": ["target_crates", "items"],
      "properties": {
        "target_crates": {
          "type": "integer",
          "description": "Number of crates to cover at this percentage"
        },
        "actual_coverage": {
          "type": "number",
          "description": "Actual coverage percentage achieved"
        },
        "items": {
          "type": "array",
          "items": { "$ref": "#/$defs/GreedyItem" },
          "description": "Ordered list of items to verify"
        }
      }
    },
    "GreedyItem": {
      "type": "object",
      "description": "An item in the greedy cover sequence",
      "required": ["rank", "name", "crates_added", "cumulative_coverage"],
      "properties": {
        "rank": {
          "type": "integer",
          "description": "Order in which this item should be verified"
        },
        "name": {
          "type": "string",
          "description": "Fully qualified item name"
        },
        "crates_added": {
          "type": "integer",
          "description": "Additional crates covered by adding this item"
        },
        "cumulative_coverage": {
          "type": "number",
          "description": "Cumulative coverage percentage after adding this item"
        }
      }
    },
    "Summary": {
      "type": "object",
      "description": "High-level summary statistics",
      "required": ["total_projects", "total_crates", "crates_with_stdlib", "unique_modules", "unique_types", "unique_traits", "unique_methods"],
      "properties": {
        "total_projects": {
          "type": "integer"
        },
        "total_crates": {
          "type": "integer"
        },
        "crates_with_stdlib": {
          "type": "integer"
        },
        "unique_modules": {
          "type": "integer"
        },
        "unique_types": {
          "type": "integer"
        },
        "unique_traits": {
          "type": "integer"
        },
        "unique_methods": {
          "type": "integer"
        },
        "coverage_to_support_70_pct": {
          "$ref": "#/$defs/CoverageSummary"
        },
        "coverage_to_support_80_pct": {
          "$ref": "#/$defs/CoverageSummary"
        },
        "coverage_to_support_90_pct": {
          "$ref": "#/$defs/CoverageSummary"
        },
        "coverage_to_support_100_pct": {
          "$ref": "#/$defs/CoverageSummary"
        }
      }
    },
    "CoverageSummary": {
      "type": "object",
      "description": "Summary of items needed for a coverage target",
      "properties": {
        "modules": {
          "type": "integer",
          "description": "Number of modules needed"
        },
        "types": {
          "type": "integer",
          "description": "Number of types needed"
        },
        "traits": {
          "type": "integer",
          "description": "Number of traits needed"
        },
        "methods": {
          "type": "integer",
          "description": "Number of methods needed"
        }
      }
    }
  }
}

